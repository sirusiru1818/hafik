<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hafik</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --gradient-1: linear-gradient(135deg, #ffd1dc 0%, #ffb5c5 100%);
            --gradient-2: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            --gradient-3: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --gradient-4: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            --gradient-accent: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --bg-dark: #f5f0f6;
            --text-primary: #2d3561;
            --text-secondary: rgba(45, 53, 97, 0.7);
        }

        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; position: relative; overflow-x: hidden; }
        .bg-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.7; overflow: hidden; pointer-events: none; }
        .bg-gradient { position: absolute; border-radius: 50%; filter: blur(120px); animation: float 30s infinite ease-in-out; }
        .bg-gradient-1 { width: 800px; height: 800px; background: var(--gradient-1); top: -300px; left: -200px; animation-delay: 0s; }
        .bg-gradient-2 { width: 700px; height: 700px; background: var(--gradient-3); bottom: -250px; right: -200px; animation-delay: 10s; }
        .bg-gradient-3 { width: 600px; height: 600px; background: var(--gradient-4); top: 50%; left: 50%; transform: translate(-50%, -50%); animation-delay: 20s; }
        .bg-gradient-4 { width: 500px; height: 500px; background: var(--gradient-2); top: 30%; right: 10%; animation-delay: 15s; }
        .bg-gradient-5 { width: 550px; height: 550px; background: linear-gradient(135deg, #ffb88c 0%, #ff9a76 100%); bottom: 10%; left: 20%; animation-delay: 5s; }
        
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.7; } 50% { transform: translate(-50px, 100px) scale(0.95); opacity: 0.6; } 75% { transform: translate(150px, 50px) scale(1.05); opacity: 0.75; } }

        .header { position: fixed; top: 0; left: 0; right: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 4rem; }
        .logo { font-size: 1.6rem; font-weight: 800; background: var(--gradient-accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -0.02em; }

        .container { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 0 2rem; }

        .hero { text-align: center; padding: 10rem 0 2rem; animation: fadeInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .hero-title { font-size: 5.5rem; font-weight: 800; letter-spacing: -0.04em; line-height: 1.15; margin-bottom: 1.8rem; background: linear-gradient(135deg, #2d3561 0%, rgba(45, 53, 97, 0.8) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .hero-highlight { background: var(--gradient-accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; position: relative; display: inline-block; filter: drop-shadow(0 0 40px rgba(240, 147, 251, 0.4)); }
        .hero-subtitle { font-size: 1.4rem; color: var(--text-secondary); max-width: 680px; margin: 0 auto; line-height: 1.6; }

        .search-section { margin-top: 8rem; padding-bottom: 6rem; animation: fadeInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both; }
        .search-input-wrapper { position: relative; z-index: 1; }

        .search-input { width: 100%; background: rgba(255, 255, 255, 0.35); backdrop-filter: blur(40px); border: 1.5px solid rgba(255, 255, 255, 0.5); border-radius: 30px; padding: 1.8rem 5rem 1.8rem 2rem; height: 140px; line-height: 1.6; font-size: 1.15rem; color: var(--text-primary); font-family: inherit; resize: none; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); font-weight: 400; box-shadow: 0 8px 32px rgba(167, 139, 250, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.3); }
        .search-input:focus { outline: none; border-color: rgba(167, 139, 250, 0.5); background: rgba(255, 255, 255, 0.45); box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.15), 0 12px 40px rgba(167, 139, 250, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.4); transform: translateY(-2px); }
        .search-button { position: absolute; bottom: 20px; right: 20px; width: 50px; height: 50px; background: rgba(240, 147, 251, 0.7); backdrop-filter: blur(10px); border: 1.5px solid rgba(255, 255, 255, 0.3); border-radius: 50%; color: #ffffff; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 16px rgba(240, 147, 251, 0.25); z-index: 10; }
        .search-button:hover { transform: scale(1.05); background: rgba(240, 147, 251, 0.8); }
        .search-button svg { width: 20px; height: 20px; fill: currentColor; margin-left: 2px; }

        .results-container { margin-top: 4rem; display: none; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .results-title { font-size: 1.8rem; font-weight: 700; letter-spacing: -0.02em; }
        .results-count { font-size: 0.9rem; font-weight: 600; color: rgba(196, 181, 253, 0.9); padding: 0.6rem 1.2rem; background: rgba(167, 139, 250, 0.1); border: 1px solid rgba(167, 139, 250, 0.25); border-radius: 20px; }
        
        .result-item { background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(30px); border: 1.5px solid rgba(167, 139, 250, 0.15); border-radius: 20px; padding: 2.2rem; margin-bottom: 1.5rem; transition: all 0.4s; cursor: pointer; }
        .result-item:hover { border-color: rgba(167, 139, 250, 0.4); transform: translateY(-6px); box-shadow: 0 20px 50px rgba(10, 10, 15, 0.1); background: rgba(255, 255, 255, 0.1); }
        .result-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; color: var(--text-primary); }
        .result-meta { display: flex; gap: 1.8rem; font-size: 0.88rem; color: var(--text-secondary); margin-bottom: 1.2rem; }
        .result-abstract { color: var(--text-secondary); line-height: 1.75; margin-bottom: 1.2rem; font-size: 0.98rem; }
        .result-score { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1.1rem; background: rgba(167, 139, 250, 0.12); border: 1.5px solid rgba(167, 139, 250, 0.3); border-radius: 20px; font-size: 0.85rem; font-weight: 700; color: #8b5cf6; }

        /* Ï∞®Ìä∏ ÏòÅÏó≠ Ïä§ÌÉÄÏùº */
        .chart-wrapper {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(40px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading { width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }

        @media (max-width: 768px) {
            .header { padding: 1.2rem 1.5rem; }
            .hero-title { font-size: 3.2rem; }
            .search-input { font-size: 1rem; padding: 1.5rem 1.5rem 4rem 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="bg-gradient bg-gradient-1"></div>
        <div class="bg-gradient bg-gradient-2"></div>
        <div class="bg-gradient bg-gradient-3"></div>
        <div class="bg-gradient bg-gradient-4"></div>
        <div class="bg-gradient bg-gradient-5"></div>
    </div>

    <header class="header">
        <div class="logo">Hafik</div>
    </header>

    <div class="container">
        <section class="hero">
            <h1 class="hero-title">
                Prove Your<br><span class="hero-highlight">Hypothesis</span>
            </h1>
            <p class="hero-subtitle">
                Enter your research hypothesis and discover scientific papers that support your theory
            </p>
        </section>

        <section class="search-section">
            <div class="search-card">
                <div class="search-input-container">
                    <div class="search-input-wrapper">
                        <textarea 
                            id="hypothesis-input" 
                            class="search-input" 
                            placeholder="E.g. You wake up before the alarm only on days you could‚Äôve slept in"
                            rows="3"
                        ></textarea>
                        <button class="search-button" id="search-button">
                            <svg viewBox="0 0 24 24">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="results-container" id="results-container">
                <div class="results-header">
                    <h2 class="results-title">Research Results</h2>
                    <span class="results-count" id="results-count"></span>
                </div>

                <div class="chart-wrapper" id="chart-wrapper" style="display: none;">
                    <canvas id="trendChart" style="max-height: 250px;"></canvas>
                </div>

                <div id="results-list"></div>
            </div>
        </section>
    </div>

    <script>
        const searchInput = document.getElementById('hypothesis-input');
        const searchButton = document.getElementById('search-button');
        const resultsContainer = document.getElementById('results-container');
        const resultsList = document.getElementById('results-list');
        const resultsCount = document.getElementById('results-count');
        
        // Ï∞®Ìä∏ Í¥ÄÎ†® Î≥ÄÏàò
        const chartWrapper = document.getElementById('chart-wrapper');
        let myChart = null;

        searchButton.addEventListener('click', async () => {
            const hypothesis = searchInput.value.trim();
            if (hypothesis.length < 2) { alert('Please enter a hypothesis.'); return; }

            const originalContent = searchButton.innerHTML;
            searchButton.disabled = true;
            searchButton.innerHTML = '<div class="loading"></div>';
            resultsContainer.style.display = 'none';
            chartWrapper.style.display = 'none'; // Í≤ÄÏÉâ ÏãúÏûë Ïãú Ï∞®Ìä∏ Ïà®ÍπÄ

            try {
                const response = await fetch(`/api/v1/search?q=${encodeURIComponent(hypothesis)}`);
                const results = await response.json();

                resultsContainer.style.display = 'block';
                resultsCount.textContent = `${results.length} papers found`;
                
                if (results.length === 0) {
                    resultsList.innerHTML = '<p style="color: #666; text-align: center;">No relevant papers found with sufficient similarity.</p>';
                } else {
                    // ‚≠ê 1. Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞ (Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏûàÏùÑ ÎïåÎßå)
                    renderChart(results);
                    chartWrapper.style.display = 'block';

                    // 2. Î¶¨Ïä§Ìä∏ Í∑∏Î¶¨Í∏∞
                    resultsList.innerHTML = results.map(paper => `
                        <div class="result-item" onclick="window.open('${paper.url}', '_blank')">
                            <h3 class="result-title">${paper.title}</h3>
                            <div class="result-meta">
                                <span>üìÖ ${paper.year}</span>
                                <span>üë§ ${paper.authors}</span>
                            </div>
                            <p class="result-abstract">${paper.abstract}</p>
                            <span class="result-score">‚ú® Match: ${paper.similarity}%</span>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Search error:', error);
                alert('Failed to connect to the server.');
            } finally {
                searchButton.disabled = false;
                searchButton.innerHTML = originalContent; 
            }
        });

        // ‚≠ê [Ï∂îÍ∞ÄÎê®] Ï∞®Ìä∏ Í∑∏Î¶¨Îäî Ìï®Ïàò
        function renderChart(papers) {
            const yearCounts = {};
            // Ïó∞ÎèÑÎ≥Ñ Í∞úÏàò ÏÑ∏Í∏∞
            papers.forEach(paper => {
                const year = paper.year;
                yearCounts[year] = (yearCounts[year] || 0) + 1;
            });

            // Ï†ïÎ†¨
            const sortedYears = Object.keys(yearCounts).sort();
            const counts = sortedYears.map(year => yearCounts[year]);

            // Í∏∞Ï°¥ Ï∞®Ìä∏ ÌååÍ¥¥ (Ï§ëÎ≥µ Î∞©ÏßÄ)
            if (myChart) {
                myChart.destroy();
            }

            // ÏÉà Ï∞®Ìä∏ ÏÉùÏÑ±
            const ctx = document.getElementById('trendChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedYears,
                    datasets: [{
                        label: 'Papers per Year',
                        data: counts,
                        backgroundColor: 'rgba(167, 139, 250, 0.7)',
                        borderColor: 'rgba(139, 92, 246, 1)',
                        borderWidth: 1,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Publication Trend (Yearly)',
                            color: '#2d3561',
                            font: { size: 14, family: "'Plus Jakarta Sans', sans-serif" }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1, precision: 0 },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                searchButton.click();
            }
        });
    </script>
</body>
</html>